var WebMIDIAPIWrapper=function(e){this.midiAccess=null;this.ports={"in":[],out:[]};this.devices={};this.sysex=e;this.performanceNow=window.performance.now();this.lastStatusByte=null};WebMIDIAPIWrapper.prototype={initMidi:function(){navigator.requestMIDIAccess({sysex:this.sysex}).then(this.scb.bind(this),this.ecb.bind(this))},scb:function(e){this.midiAccess=e;this.devices.inputs=this.midiAccess.inputs();this.devices.outputs=this.midiAccess.outputs();this.setMidiInputSelect.bind(this)();this.setMidiOutputSelect.bind(this)();console.log("[OutputDevices] ",this.devices.outputs,"[InputDevices]",this.devices.inputs)},ecb:function(e){console.log("[ERROR] "+e)},setMidiInputSelect:function(){console.log("[ERROR] Set EventHandler : setMidiInputSelect")},setMidiOutputSelect:function(){console.log("[ERROR] Set EventHandler : setMidiOutputSelect")},setMidiInputToPort:function(e,t,n){var t=0;this.ports.in[t]=this.devices.inputs[e];this.ports.in[t].onmidimessage=n.bind(this)},setMidiOutputToPort:function(e,t){var t=0;this.ports.out[t]=this.devices.outputs[e];this.setPitchBendValue(0,0,16383,8192)},initializePerformanceNow:function(){this.performanceNow=window.performance.now()},_checkTyeof:function(e,t){var n=Object.prototype.toString.call(t).slice(8,-1);return t!==undefined&&t!==null&&n===e},_checkPortNo:function(e){if(isNaN(e)===true){console.log("[ERROR] PortNo is NOT the type of number. ["+e+"]");return false}return parseInt(e,10)},sendNoteOn:function(e,t,n,r,i){var e=this._checkPortNo(e);if(e===false){console.log("[ERROR] @sendNoteOn");return}var s=this.performanceNow;var o=parseInt("0x9"+t.toString(16),16);if(typeof i!=="number"){i=0}var u=[o,n,r];this.ports.out[e].send(u,s+i)},sendNoteOff:function(e,t,n,r,i){var e=this._checkPortNo(e);if(e===false){console.log("[ERROR] @sendNoteOn");return}var s=this.performanceNow;var o=parseInt("0x8"+t.toString(16),16);if(typeof i!=="number"){i=0}var u=[o,n,r];this.ports.out[e].send(u,s+i)},sendProgramChange:function(e,t,n,r){var e=this._checkPortNo(e);if(e===false){console.log("[ERROR] @sendNoteOn");return}var i=this.performanceNow;var s=s<0?0:s>127?127:s;var o=parseInt("0xc"+t.toString(16),16);if(typeof r!=="number"){r=0}var u=[o,n];this.ports.out[e].send(u,i+r)},setPitchBendValue:function(e,t,n,r){this.ports.out[e].pitchBendValue={min:parseInt(t),max:parseInt(n),center:parseInt(r)}},sendPitchBend:function(e,t,n,r){var e=this._checkPortNo(e);if(e===false){console.log("[ERROR] @sendNoteOn");return}var i=this.performanceNow;var s=parseInt("0xe"+t.toString(16),16);var n=n<this.ports.out[e].pitchBendValue.min?this.ports.out[e].pitchBendValue.min:n>this.ports.out[e].pitchBendValue.max?this.ports.out[e].pitchBendValue.max:n;var o=~~(n/128);var u=n%128;var a=[s,u,o];this.ports.out[e].send(a,i+r)},sendSustainStatus:function(e,t,n,r){var e=this._checkPortNo(e);if(e===false){console.log("[ERROR] @sendNoteOn");return}var i=this.performanceNow;var s=parseInt("0xb"+t.toString(16),16);var o=[s,64,0];switch(n){case"on":o=[s,64,127];break}this.ports.out[e].send(o,i+r)},sendModulationValue:function(e,t,n,r){var e=this._checkPortNo(e);if(e===false){console.log("[ERROR] @sendNoteOn");return}var i=this.performanceNow;var s=parseInt("0xb"+t.toString(16),16);var n=n<0?0:n>127?127:n;var o=[s,1,n];this.ports.out[e].send(o,i+r)},sendAllSoundOff:function(e,t,n){var e=this._checkPortNo(e);if(e===false){console.log("[ERROR] @sendNoteOn");return}var r=this.performanceNow;var i=parseInt("0xb"+t.toString(16),16);var s=[i,120,0];this.ports.out[e].send(s,r+n)},sendResetAllController:function(e,t,n){var e=this._checkPortNo(e);if(e===false){console.log("[ERROR] @sendNoteOn");return}var r=this.performanceNow;var i=parseInt("0xb"+t.toString(16),16);var s=[i,121,0];this.ports.out[e].send(s,r+n)},sendAllNoteOff:function(e,t,n){var e=this._checkPortNo(e);if(e===false){console.log("[ERROR] @sendNoteOn");return}var r=this.performanceNow;var i=parseInt("0xb"+t.toString(16),16);var s=[i,123,0];this.ports.out[e].send(s,r+n)},sendRaw:function(e,t,n){var e=this._checkPortNo(e);if(e===false){console.log("[ERROR] @sendNoteOn");return}var r=this.performanceNow;if(this._checkTyeof("array",t)===true){console.log("[Error] SendRaw : msg must array."+t);return}this.ports.out[e].send(t,r+n)},parseMIDIMessage:function(e){if(typeof e!=="object"){return}var t=new Array;var n={};var r={};for(var i=0;i<e.data.length;i++){t.push(e.data[i].toString(16))}var s=parseInt(e[0],16);if((e[0]&240)==240){if(e[0]==240){n.type="SysEx";n.raw=e}else{console.log("Not Supportted Message. ",e)}r={type:n.type,data:n.raw,event:n}}else{n.type="channel";n.raw=e;this.lastStatusByte=t[0];n.statusNum=t[0].replace("0x","").substr(0,1).toLowerCase();n.channel=parseInt(t[0].replace("0x","").substr(1,1),16);switch(n.statusNum){case"8":n.subType="noteOff";n.noteNumber=e.data[1];n.velocity=e.data[2];break;case"9":n.subType="noteOn";n.noteNumber=e.data[1];n.velocity=e.data[2];if(n.velocity==0){n.subType="noteOff"}break;case"a":n.subType="noteAftertouch";n.noteNumber=e.data[1];n.amount=e.data[2];break;case"b":n.subType="controller";n.ctrlNo=e.data[1];n.value=e.data[2];switch(n.ctrlNo){case 0:case"0x00":n.ctrlName="BankSelect";n.valueType="MSB";break;case 32:case"0x20":n.ctrlName="BankSelect";n.valueType="LSB";break;case 1:case"0x01":n.ctrlName="Modulation";n.valueType="MSB";break;case 33:case"0x21":n.ctrlName="Modulation";n.valueType="LSB";break;case 5:case"0x05":n.ctrlName="Portament";n.valueType="MSB";break;case 37:case"0x25":n.ctrlName="Portament";n.valueType="LSB";break;case 6:case"0x06":n.ctrlName="DataEntry";n.valueType="MSB";break;case 38:case"0x26":n.ctrlName="DataEntry";n.valueType="LSB";break;case 7:case"0x07":n.ctrlName="MainVolume";n.valueType="MSB";break;case 39:case"0x27":n.ctrlName="MainVolume";n.valueType="LSB";break;case 16:case"0x10":n.ctrlName="PanPot";n.valueType="MSB";break;case 42:case"0x2a":n.ctrlName="PanPot";n.valueType="LSB";break;case 17:case"0x11":n.ctrlName="Expression";n.valueType="MSB";break;case 43:case"0x2b":n.ctrlName="Expression";n.valueType="LSB";break;case 64:case"0x40":n.ctrlName="Hold";n.ctrlStatus="Off";if(n.value>=64){n.ctrlStatus="On"}break;case 65:case"0x41":n.ctrlName="Portament";n.ctrlStatus="Off";if(n.value>=64){n.ctrlStatus="On"}break;case 66:case"0x42":n.ctrlName="SosTenuto";n.ctrlStatus="Off";if(n.value>=64){n.ctrlStatus="On"}break;case 67:case"0x43":n.ctrlName="SoftPedal";n.ctrlStatus="Off";if(n.value>=64){n.ctrlStatus="On"}break;case 70:case"0x46":n.ctrlName="SoundController1";break;case 71:case"0x47":n.ctrlName="SoundController2";break;case 72:case"0x48":n.ctrlName="SoundController3";break;case 73:case"0x49":n.ctrlName="SoundController4";break;case 80:case"0x50":n.ctrlName="SoundController5";break;case 91:case"0x5b":n.ctrlName="effectSendLevel1";break;case 93:case"0x5d":n.ctrlName="effectSendLevel3";break;case 94:case"0x5e":n.ctrlName="effectSendLevel4";break;case 96:case"0x60":n.ctrlName="DataIncrement";break;case 97:case"0x61":n.ctrlName="DataDecrement";break;case 98:case"0x62":n.ctrlName="NRPN";n.valueType="LSB";break;case 99:case"0x63":n.ctrlName="NRPN";n.valueType="MSB";break;case 100:case"0x64":n.ctrlName="RPN";n.valueType="LSB";break;case 101:case"0x65":n.ctrlName="RPN";n.valueType="MSB";break;case 120:case"0x78":n.ctrlName="AllSoundOff";break;case 121:case"0x79":n.ctrlName="ResetAllController";break;case 123:case"0x7b":n.ctrlName="OmniOff";break;case 124:case"0x7c":n.ctrlName="OmniOn";break;case 126:case"0x7e":n.ctrlName="Mono";break;case 127:case"0x7f":n.ctrlName="Poly";break;default:n.ctrlName="NotDefined";break}break;case"c":n.subType="programChange";n.programNumber=e[1];break;case"d":n.subType="channelAftertouch";n.amount=e.data[1];break;case"e":n.subType="pitchBend";var o=e.data[2],u=e.data[1];if((e[2]>>6).toString(2)=="1"){n.value=-1*((o-64<<7)+u+1)}else{var a=o<<7;n.value=a+u}break;default:console.log("Not Supportted Message. ",e);return;break}r={type:n.type,subType:n.subType,data:n.raw,event:n}}return r}}