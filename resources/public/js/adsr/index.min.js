function ADSR(e){if(!(this instanceof ADSR)){return new ADSR(e)}this._targets=[];this.context=e;this.attack=0;this.decay=0;this.value=1;this.sustain=1;this.release=0;this.startValue=0;this.endValue=0}function getTimeConstant(e){return Math.log(e+1)/Math.log(100)}function getValue(e,t,n,r,i){var s=t-e;var o=r-n;var u=i-n;var a=u/o;return e+a*s}ADSR.prototype={constructor:ADSR,start:function(e){this._decayFrom=this._decayFrom=e+this.attack;this._startedAt=e;var t=this._targets;for(var n=0;n<t.length;n++){var r=t[n];var i=this.value*this.sustain;r.cancelScheduledValues(e);if(this.attack){r.setValueAtTime(this.startValue,e);r.linearRampToValueAtTime(this.value,e+this.attack)}else{r.setValueAtTime(this.value,e)}if(this.decay){r.setTargetAtTime(i,this._decayFrom,getTimeConstant(this.decay))}}},stop:function(e,t){if(t){e=e-this.release}var n=e+this.release;if(this.release){var r=this._targets;for(var i=0;i<r.length;i++){var s=r[i];s.cancelScheduledValues(e);if(this.attack&&e<this._decayFrom){var o=getValue(this.startValue,this.value,this._startedAt,this._decayFrom,e);s.linearRampToValueAtTime(o,e)}s.setTargetAtTime(this.endValue,e,getTimeConstant(this.release))}}return n},connect:function(e){if(!~this._targets.indexOf(e)){this._targets.push(e)}},disconnect:function(){var e=this._targets;for(var t=0;t<e.length;t++){var n=e[t];n.cancelScheduledValues(this.context.currentTime);n.setValueAtTime(this.value,this.context.currentTime)}e.length=0}}